// Generated by CoffeeScript 2.7.0
var splitByTopLevelPipe;

import {
  print,
  assert
} from './globals.js';


// Lisp, kind of - more compact tree rep than XML and JSON
export var parseExpr = function(expr) {
  var parts;
  if (expr.startsWith('(') && expr.endsWith(')')) {
    expr = expr.slice(1, -1);
  }
  parts = splitByTopLevelPipe(expr);
  return parts.map(function(part) {
    if (part.startsWith('(') && part.endsWith(')')) {
      return parseExpr(part);
    } else {
      return part;
    }
  });
};

splitByTopLevelPipe = function(expr) {
  var char, i, j, len, level, part, parts;
  parts = [];
  part = '';
  level = 0;
  for (i = j = 0, len = expr.length; j < len; i = ++j) {
    char = expr[i];
    if (char === '(') {
      level++;
    } else if (char === ')') {
      level--;
    }
    if (char === '|' && level === 0) {
      parts.push(part);
      part = '';
    } else {
      part += char;
    }
  }
  if (part) {
    parts.push(part);
  }
  return parts;
};

assert(["1234", "Christer"], parseExpr("(1234|Christer)"));

assert(["1234", "Christer"], parseExpr("1234|Christer"));

assert(["1234", "Christer", ["12w0", "23b½", "14w"]], parseExpr("(1234|Christer|(12w0|23b½|14w))"));

assert(["1234", "Christer", ["12w0", "23b½", "14w"]], parseExpr("1234|Christer|(12w0|23b½|14w)"));

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFyc2VyLmpzIiwic291cmNlUm9vdCI6Ii4uXFwiLCJzb3VyY2VzIjpbImNvZmZlZVxccGFyc2VyLmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsSUFBQTs7QUFBQSxPQUFBO0VBQVMsS0FBVDtFQUFlLE1BQWY7Q0FBQSxNQUFBLGVBQUE7Ozs7QUFJQSxPQUFBLElBQU8sU0FBQSxHQUFZLFFBQUEsQ0FBQyxJQUFELENBQUE7QUFDbkIsTUFBQTtFQUFDLElBQUcsSUFBSSxDQUFDLFVBQUwsQ0FBZ0IsR0FBaEIsQ0FBQSxJQUF5QixJQUFJLENBQUMsUUFBTCxDQUFjLEdBQWQsQ0FBNUI7SUFBb0QsSUFBQSxHQUFPLElBQUksQ0FBQyxLQUFMLENBQVcsQ0FBWCxFQUFjLENBQUMsQ0FBZixFQUEzRDs7RUFDQSxLQUFBLEdBQVEsbUJBQUEsQ0FBb0IsSUFBcEI7U0FDUixLQUFLLENBQUMsR0FBTixDQUFVLFFBQUEsQ0FBQyxJQUFELENBQUE7SUFBVSxJQUFHLElBQUksQ0FBQyxVQUFMLENBQWdCLEdBQWhCLENBQUEsSUFBeUIsSUFBSSxDQUFDLFFBQUwsQ0FBYyxHQUFkLENBQTVCO2FBQW9ELFNBQUEsQ0FBVSxJQUFWLEVBQXBEO0tBQUEsTUFBQTthQUF3RSxLQUF4RTs7RUFBVixDQUFWO0FBSGtCOztBQUtuQixtQkFBQSxHQUFzQixRQUFBLENBQUMsSUFBRCxDQUFBO0FBQ3RCLE1BQUEsSUFBQSxFQUFBLENBQUEsRUFBQSxDQUFBLEVBQUEsR0FBQSxFQUFBLEtBQUEsRUFBQSxJQUFBLEVBQUE7RUFBQyxLQUFBLEdBQVE7RUFDUixJQUFBLEdBQU87RUFDUCxLQUFBLEdBQVE7RUFDUixLQUFBLDhDQUFBOztJQUNDLElBQUcsSUFBQSxLQUFRLEdBQVg7TUFBb0IsS0FBQSxHQUFwQjtLQUFBLE1BQ0ssSUFBRyxJQUFBLEtBQVEsR0FBWDtNQUFtQixLQUFBLEdBQW5COztJQUNMLElBQUcsSUFBQSxLQUFRLEdBQVIsSUFBZ0IsS0FBQSxLQUFTLENBQTVCO01BQ0MsS0FBSyxDQUFDLElBQU4sQ0FBVyxJQUFYO01BQ0EsSUFBQSxHQUFPLEdBRlI7S0FBQSxNQUFBO01BR0ssSUFBQSxJQUFRLEtBSGI7O0VBSEQ7RUFPQSxJQUFtQixJQUFuQjtJQUFBLEtBQUssQ0FBQyxJQUFOLENBQVcsSUFBWCxFQUFBOztTQUNBO0FBWnFCOztBQWN0QixNQUFBLENBQU8sQ0FBQyxNQUFELEVBQVEsVUFBUixDQUFQLEVBQTRCLFNBQUEsQ0FBVSxpQkFBVixDQUE1Qjs7QUFDQSxNQUFBLENBQU8sQ0FBQyxNQUFELEVBQVEsVUFBUixDQUFQLEVBQTRCLFNBQUEsQ0FBVSxlQUFWLENBQTVCOztBQUNBLE1BQUEsQ0FBTyxDQUFDLE1BQUQsRUFBUSxVQUFSLEVBQW1CLENBQUMsTUFBRCxFQUFRLE1BQVIsRUFBZSxLQUFmLENBQW5CLENBQVAsRUFBa0QsU0FBQSxDQUFVLGlDQUFWLENBQWxEOztBQUNBLE1BQUEsQ0FBTyxDQUFDLE1BQUQsRUFBUSxVQUFSLEVBQW1CLENBQUMsTUFBRCxFQUFRLE1BQVIsRUFBZSxLQUFmLENBQW5CLENBQVAsRUFBa0QsU0FBQSxDQUFVLCtCQUFWLENBQWxEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgcHJpbnQsYXNzZXJ0IH0gZnJvbSAnLi9nbG9iYWxzLmpzJyBcclxuXHJcbiMgTGlzcCwga2luZCBvZiAtIG1vcmUgY29tcGFjdCB0cmVlIHJlcCB0aGFuIFhNTCBhbmQgSlNPTlxyXG5cclxuZXhwb3J0IHBhcnNlRXhwciA9IChleHByKSAtPlxyXG5cdGlmIGV4cHIuc3RhcnRzV2l0aCgnKCcpIGFuZCBleHByLmVuZHNXaXRoKCcpJykgdGhlbiBleHByID0gZXhwci5zbGljZSAxLCAtMVxyXG5cdHBhcnRzID0gc3BsaXRCeVRvcExldmVsUGlwZSBleHByXHJcblx0cGFydHMubWFwIChwYXJ0KSAtPiBpZiBwYXJ0LnN0YXJ0c1dpdGgoJygnKSBhbmQgcGFydC5lbmRzV2l0aCgnKScpIHRoZW4gcGFyc2VFeHByIHBhcnQgZWxzZSBwYXJ0XHJcblxyXG5zcGxpdEJ5VG9wTGV2ZWxQaXBlID0gKGV4cHIpIC0+XHJcblx0cGFydHMgPSBbXVxyXG5cdHBhcnQgPSAnJ1xyXG5cdGxldmVsID0gMFxyXG5cdGZvciBjaGFyLCBpIGluIGV4cHJcclxuXHRcdGlmIGNoYXIgPT0gJygnIHRoZW4gbGV2ZWwrK1xyXG5cdFx0ZWxzZSBpZiBjaGFyID09ICcpJ3RoZW4gbGV2ZWwtLVxyXG5cdFx0aWYgY2hhciA9PSAnfCcgYW5kIGxldmVsID09IDBcclxuXHRcdFx0cGFydHMucHVzaCBwYXJ0XHJcblx0XHRcdHBhcnQgPSAnJ1xyXG5cdFx0ZWxzZSBwYXJ0ICs9IGNoYXJcclxuXHRwYXJ0cy5wdXNoIHBhcnQgaWYgcGFydFxyXG5cdHBhcnRzXHJcblxyXG5hc3NlcnQgW1wiMTIzNFwiLFwiQ2hyaXN0ZXJcIl0sIHBhcnNlRXhwciBcIigxMjM0fENocmlzdGVyKVwiXHJcbmFzc2VydCBbXCIxMjM0XCIsXCJDaHJpc3RlclwiXSwgcGFyc2VFeHByIFwiMTIzNHxDaHJpc3RlclwiXHJcbmFzc2VydCBbXCIxMjM0XCIsXCJDaHJpc3RlclwiLFtcIjEydzBcIixcIjIzYsK9XCIsXCIxNHdcIl1dLCBwYXJzZUV4cHIgXCIoMTIzNHxDaHJpc3RlcnwoMTJ3MHwyM2LCvXwxNHcpKVwiXHJcbmFzc2VydCBbXCIxMjM0XCIsXCJDaHJpc3RlclwiLFtcIjEydzBcIixcIjIzYsK9XCIsXCIxNHdcIl1dLCBwYXJzZUV4cHIgXCIxMjM0fENocmlzdGVyfCgxMncwfDIzYsK9fDE0dylcIlxyXG5cclxuIl19
//# sourceURL=c:\github\Dense\coffee\parser.coffee