// Generated by CoffeeScript 2.7.0
var BAR, splitByTopLevelPipe;

import {
  print,
  assert
} from './globals.js';


// Lisp, kind of - more compact tree rep than XML and JSON
BAR = '!'; // was |

export var parseExpr = function(expr) {
  var parts;
  if (expr.startsWith('(') && expr.endsWith(')')) {
    expr = expr.slice(1, -1);
  }
  parts = splitByTopLevelPipe(expr);
  return parts.map(function(part) {
    if (part.startsWith('(') && part.endsWith(')')) {
      return parseExpr(part);
    } else {
      return part;
    }
  });
};

splitByTopLevelPipe = function(expr) {
  var char, i, j, len, level, part, parts;
  parts = [];
  part = '';
  level = 0;
  for (i = j = 0, len = expr.length; j < len; i = ++j) {
    char = expr[i];
    if (char === '(') {
      level++;
    } else if (char === ')') {
      level--;
    }
    if (char === BAR && level === 0) {
      parts.push(part);
      part = '';
    } else {
      part += char;
    }
  }
  if (part) {
    parts.push(part);
  }
  return parts;
};

assert(["1234", "Christer"], parseExpr("(1234!Christer)"));

assert(["1234", "Christer"], parseExpr("1234!Christer"));

assert(["1234", "Christer", ["12w0", "23b½", "14w"]], parseExpr("(1234!Christer!(12w0!23b½!14w))"));

assert(["1234", "Christer", ["12w0", "23b½", "14w"]], parseExpr("1234!Christer!(12w0!23b½!14w)"));

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFyc2VyLmpzIiwic291cmNlUm9vdCI6Ii4uXFwiLCJzb3VyY2VzIjpbImNvZmZlZVxccGFyc2VyLmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsSUFBQSxHQUFBLEVBQUE7O0FBQUEsT0FBQTtFQUFTLEtBQVQ7RUFBZSxNQUFmO0NBQUEsTUFBQSxlQUFBOzs7O0FBSUEsR0FBQSxHQUFNLElBSk47O0FBTUEsT0FBQSxJQUFPLFNBQUEsR0FBWSxRQUFBLENBQUMsSUFBRCxDQUFBO0FBQ25CLE1BQUE7RUFBQyxJQUFHLElBQUksQ0FBQyxVQUFMLENBQWdCLEdBQWhCLENBQUEsSUFBeUIsSUFBSSxDQUFDLFFBQUwsQ0FBYyxHQUFkLENBQTVCO0lBQW9ELElBQUEsR0FBTyxJQUFJLENBQUMsS0FBTCxDQUFXLENBQVgsRUFBYyxDQUFDLENBQWYsRUFBM0Q7O0VBQ0EsS0FBQSxHQUFRLG1CQUFBLENBQW9CLElBQXBCO1NBQ1IsS0FBSyxDQUFDLEdBQU4sQ0FBVSxRQUFBLENBQUMsSUFBRCxDQUFBO0lBQVUsSUFBRyxJQUFJLENBQUMsVUFBTCxDQUFnQixHQUFoQixDQUFBLElBQXlCLElBQUksQ0FBQyxRQUFMLENBQWMsR0FBZCxDQUE1QjthQUFvRCxTQUFBLENBQVUsSUFBVixFQUFwRDtLQUFBLE1BQUE7YUFBd0UsS0FBeEU7O0VBQVYsQ0FBVjtBQUhrQjs7QUFLbkIsbUJBQUEsR0FBc0IsUUFBQSxDQUFDLElBQUQsQ0FBQTtBQUN0QixNQUFBLElBQUEsRUFBQSxDQUFBLEVBQUEsQ0FBQSxFQUFBLEdBQUEsRUFBQSxLQUFBLEVBQUEsSUFBQSxFQUFBO0VBQUMsS0FBQSxHQUFRO0VBQ1IsSUFBQSxHQUFPO0VBQ1AsS0FBQSxHQUFRO0VBQ1IsS0FBQSw4Q0FBQTs7SUFDQyxJQUFHLElBQUEsS0FBUSxHQUFYO01BQW9CLEtBQUEsR0FBcEI7S0FBQSxNQUNLLElBQUcsSUFBQSxLQUFRLEdBQVg7TUFBbUIsS0FBQSxHQUFuQjs7SUFDTCxJQUFHLElBQUEsS0FBUSxHQUFSLElBQWdCLEtBQUEsS0FBUyxDQUE1QjtNQUNDLEtBQUssQ0FBQyxJQUFOLENBQVcsSUFBWDtNQUNBLElBQUEsR0FBTyxHQUZSO0tBQUEsTUFBQTtNQUdLLElBQUEsSUFBUSxLQUhiOztFQUhEO0VBT0EsSUFBbUIsSUFBbkI7SUFBQSxLQUFLLENBQUMsSUFBTixDQUFXLElBQVgsRUFBQTs7U0FDQTtBQVpxQjs7QUFjdEIsTUFBQSxDQUFPLENBQUMsTUFBRCxFQUFRLFVBQVIsQ0FBUCxFQUE0QixTQUFBLENBQVUsaUJBQVYsQ0FBNUI7O0FBQ0EsTUFBQSxDQUFPLENBQUMsTUFBRCxFQUFRLFVBQVIsQ0FBUCxFQUE0QixTQUFBLENBQVUsZUFBVixDQUE1Qjs7QUFDQSxNQUFBLENBQU8sQ0FBQyxNQUFELEVBQVEsVUFBUixFQUFtQixDQUFDLE1BQUQsRUFBUSxNQUFSLEVBQWUsS0FBZixDQUFuQixDQUFQLEVBQWtELFNBQUEsQ0FBVSxpQ0FBVixDQUFsRDs7QUFDQSxNQUFBLENBQU8sQ0FBQyxNQUFELEVBQVEsVUFBUixFQUFtQixDQUFDLE1BQUQsRUFBUSxNQUFSLEVBQWUsS0FBZixDQUFuQixDQUFQLEVBQWtELFNBQUEsQ0FBVSwrQkFBVixDQUFsRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHByaW50LGFzc2VydCB9IGZyb20gJy4vZ2xvYmFscy5qcycgXHJcblxyXG4jIExpc3AsIGtpbmQgb2YgLSBtb3JlIGNvbXBhY3QgdHJlZSByZXAgdGhhbiBYTUwgYW5kIEpTT05cclxuXHJcbkJBUiA9ICchJyAjIHdhcyB8XHJcblxyXG5leHBvcnQgcGFyc2VFeHByID0gKGV4cHIpIC0+XHJcblx0aWYgZXhwci5zdGFydHNXaXRoKCcoJykgYW5kIGV4cHIuZW5kc1dpdGgoJyknKSB0aGVuIGV4cHIgPSBleHByLnNsaWNlIDEsIC0xXHJcblx0cGFydHMgPSBzcGxpdEJ5VG9wTGV2ZWxQaXBlIGV4cHJcclxuXHRwYXJ0cy5tYXAgKHBhcnQpIC0+IGlmIHBhcnQuc3RhcnRzV2l0aCgnKCcpIGFuZCBwYXJ0LmVuZHNXaXRoKCcpJykgdGhlbiBwYXJzZUV4cHIgcGFydCBlbHNlIHBhcnRcclxuXHJcbnNwbGl0QnlUb3BMZXZlbFBpcGUgPSAoZXhwcikgLT5cclxuXHRwYXJ0cyA9IFtdXHJcblx0cGFydCA9ICcnXHJcblx0bGV2ZWwgPSAwXHJcblx0Zm9yIGNoYXIsIGkgaW4gZXhwclxyXG5cdFx0aWYgY2hhciA9PSAnKCcgdGhlbiBsZXZlbCsrXHJcblx0XHRlbHNlIGlmIGNoYXIgPT0gJykndGhlbiBsZXZlbC0tXHJcblx0XHRpZiBjaGFyID09IEJBUiBhbmQgbGV2ZWwgPT0gMFxyXG5cdFx0XHRwYXJ0cy5wdXNoIHBhcnRcclxuXHRcdFx0cGFydCA9ICcnXHJcblx0XHRlbHNlIHBhcnQgKz0gY2hhclxyXG5cdHBhcnRzLnB1c2ggcGFydCBpZiBwYXJ0XHJcblx0cGFydHNcclxuXHJcbmFzc2VydCBbXCIxMjM0XCIsXCJDaHJpc3RlclwiXSwgcGFyc2VFeHByIFwiKDEyMzQhQ2hyaXN0ZXIpXCJcclxuYXNzZXJ0IFtcIjEyMzRcIixcIkNocmlzdGVyXCJdLCBwYXJzZUV4cHIgXCIxMjM0IUNocmlzdGVyXCJcclxuYXNzZXJ0IFtcIjEyMzRcIixcIkNocmlzdGVyXCIsW1wiMTJ3MFwiLFwiMjNiwr1cIixcIjE0d1wiXV0sIHBhcnNlRXhwciBcIigxMjM0IUNocmlzdGVyISgxMncwITIzYsK9ITE0dykpXCJcclxuYXNzZXJ0IFtcIjEyMzRcIixcIkNocmlzdGVyXCIsW1wiMTJ3MFwiLFwiMjNiwr1cIixcIjE0d1wiXV0sIHBhcnNlRXhwciBcIjEyMzQhQ2hyaXN0ZXIhKDEydzAhMjNiwr0hMTR3KVwiXHJcblxyXG4iXX0=
//# sourceURL=c:\github\ELO-Pairings\coffee\parser.coffee