// Generated by CoffeeScript 2.7.0
var indexOf = [].indexOf;

import {
  g,
  print,
  range,
  scalex,
  scaley,
  wrap
} from './globals.js';

export var Player = class Player {
  constructor(id1, name = "", elo = "1400", opp = [], col1 = "", res1 = "", active = true) {
    this.id = id1;
    this.name = name;
    this.elo = elo;
    this.opp = opp;
    this.col = col1;
    this.res = res1;
    this.active = active;
    this.cache = {};
    this.pos = []; // one for each round
  }

  toggle() {
    var p;
    this.active = !this.active;
    return g.tournament.paused = (function() {
      var j, len, ref, results;
      ref = g.tournament.persons;
      results = [];
      for (j = 0, len = ref.length; j < len; j++) {
        p = ref[j];
        if (!p.active) {
          results.push(p.id);
        }
      }
      return results;
    })();
  }

  bye() {
    var ref;
    return ref = g.BYE, indexOf.call(this.opp, ref) >= 0;
  }

  calcRound(r) {
    var a, b, diff;
    if (this.opp[r] === g.BYE) {
      return g.K * (1.0 - g.scoringProbability(0));
    }
    if (this.opp[r] === g.PAUSE) {
      return 0;
    }
    if (r >= this.res.length) {
      return 0;
    }
    a = this.elo;
    b = g.tournament.persons[this.opp[r]].elo;
    diff = b - a;
    return g.K * (this.res[r] / 2 - g.scoringProbability(diff));
  }

  change(rounds) {
    var r;
    if (rounds in this.cache) {
      return this.cache[rounds];
    }
    return this.cache[rounds] = g.sum((function() {
      var j, len, ref, results;
      ref = range(rounds);
      results = [];
      for (j = 0, len = ref.length; j < len; j++) {
        r = ref[j];
        results.push(this.calcRound(r));
      }
      return results;
    }).call(this));
  }

  avgEloDiff() {
    var id, j, len, ref, res;
    res = [];
    ref = this.opp.slice(0, this.opp.length - 1);
    for (j = 0, len = ref.length; j < len; j++) {
      id = ref[j];
      if (id >= 0) {
        res.push(abs(this.elo - g.tournament.persons[id].elo));
      }
    }
    if (res.length === 0) {
      return 0;
    } else {
      return g.sum(res) / res.length;
    }
  }

  balans() { // f√§rgbalans
    var ch, j, len, ref, result;
    result = 0;
    ref = this.col;
    for (j = 0, len = ref.length; j < len; j++) {
      ch = ref[j];
      if (ch === 'b') {
        result -= 1;
      }
      if (ch === 'w') {
        result += 1;
      }
    }
    return result;
  }

  read(player) {
    var arr, col, j, len, ocr, ocrs, results;
    this.elo = parseInt(player[0]);
    this.name = player[1];
    this.opp = [];
    this.col = "";
    this.res = "";
    if (player.length < 3) {
      return;
    }
    ocrs = player[2];
    results = [];
    for (j = 0, len = ocrs.length; j < len; j++) {
      ocr = ocrs[j];
      if (indexOf.call(ocr, 'w') >= 0) {
        col = 'w';
      }
      if (indexOf.call(ocr, 'b') >= 0) {
        col = 'b';
      }
      if (indexOf.call(ocr, '_') >= 0) {
        col = '_';
      }
      arr = ocr.split(col);
      this.opp.push(parseInt(arr[0]));
      this.col += col;
      if (arr.length === 2 && arr[1].length === 1) {
        results.push(this.res += arr[1]);
      } else {
        results.push(void 0);
      }
    }
    return results;
  }

  write() { // (1234!Christer!(12w0!23b1!14w2)) Elo:1234 Name:Christer opponent:23 color:b result:1
    var i, ocr, r, res;
    res = [];
    res.push(this.elo);
    res.push(this.name.replaceAll(' ', '_'));
    r = this.opp.length - 1;
    ocr = (function() {
      var j, len, ref, results;
      ref = range(r);
      results = [];
      for (j = 0, len = ref.length; j < len; j++) {
        i = ref[j];
        results.push(`${this.opp[i]}${this.col[i]}${i < r ? this.res[i] : ''}`);
      }
      return results;
    }).call(this);
    res.push(wrap(ocr.join('!')));
    return res.join('!');
  }

};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGxheWVyLmpzIiwic291cmNlUm9vdCI6Ii4uXFwiLCJzb3VyY2VzIjpbImNvZmZlZVxccGxheWVyLmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsSUFBQTs7QUFBQSxPQUFBO0VBQVMsQ0FBVDtFQUFXLEtBQVg7RUFBaUIsS0FBakI7RUFBdUIsTUFBdkI7RUFBOEIsTUFBOUI7RUFBcUMsSUFBckM7Q0FBQSxNQUFBOztBQUVBLE9BQUEsSUFBYSxTQUFOLE1BQUEsT0FBQTtFQUNOLFdBQWMsSUFBQSxTQUFZLEVBQVosUUFBcUIsTUFBckIsUUFBa0MsRUFBbEMsU0FBMkMsRUFBM0MsU0FBb0QsRUFBcEQsV0FBa0UsSUFBbEUsQ0FBQTtJQUFDLElBQUMsQ0FBQTtJQUFJLElBQUMsQ0FBQTtJQUFTLElBQUMsQ0FBQTtJQUFZLElBQUMsQ0FBQTtJQUFRLElBQUMsQ0FBQTtJQUFRLElBQUMsQ0FBQTtJQUFRLElBQUMsQ0FBQTtJQUN0RSxJQUFDLENBQUEsS0FBRCxHQUFTLENBQUE7SUFDVCxJQUFDLENBQUEsR0FBRCxHQUFPLEdBRk07RUFBQTs7RUFJZCxNQUFTLENBQUEsQ0FBQTtBQUNWLFFBQUE7SUFBRSxJQUFDLENBQUEsTUFBRCxHQUFVLENBQUksSUFBQyxDQUFBO1dBQ2YsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxNQUFiOztBQUF1QjtBQUFBO01BQUEsS0FBQSxxQ0FBQTs7WUFBd0MsQ0FBSSxDQUFDLENBQUM7dUJBQTlDLENBQUMsQ0FBQzs7TUFBRixDQUFBOzs7RUFGZjs7RUFJVCxHQUFNLENBQUEsQ0FBQTtBQUFFLFFBQUE7aUJBQUMsQ0FBQyxDQUFDLGtCQUFPLElBQUMsQ0FBQSxLQUFWO0VBQUg7O0VBRU4sU0FBWSxDQUFDLENBQUQsQ0FBQTtBQUNiLFFBQUEsQ0FBQSxFQUFBLENBQUEsRUFBQTtJQUFFLElBQUcsSUFBQyxDQUFBLEdBQUcsQ0FBQyxDQUFELENBQUosS0FBVyxDQUFDLENBQUMsR0FBaEI7QUFBeUIsYUFBTyxDQUFDLENBQUMs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c291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZyxwcmludCxyYW5nZSxzY2FsZXgsc2NhbGV5LHdyYXAgfSBmcm9tICcuL2dsb2JhbHMuanMnIFxyXG5cclxuZXhwb3J0IGNsYXNzIFBsYXllclxyXG5cdGNvbnN0cnVjdG9yIDogKEBpZCwgQG5hbWU9XCJcIiwgQGVsbz1cIjE0MDBcIiwgQG9wcD1bXSwgQGNvbD1cIlwiLCBAcmVzPVwiXCIsIEBhY3RpdmUgPSB0cnVlKSAtPiBcclxuXHRcdEBjYWNoZSA9IHt9XHJcblx0XHRAcG9zID0gW10gIyBvbmUgZm9yIGVhY2ggcm91bmRcclxuXHJcblx0dG9nZ2xlIDogLT4gXHJcblx0XHRAYWN0aXZlID0gbm90IEBhY3RpdmVcclxuXHRcdGcudG91cm5hbWVudC5wYXVzZWQgPSAocC5pZCBmb3IgcCBpbiBnLnRvdXJuYW1lbnQucGVyc29ucyB3aGVuIG5vdCBwLmFjdGl2ZSlcclxuXHJcblx0YnllIDogLT4gZy5CWUUgaW4gQG9wcFxyXG5cclxuXHRjYWxjUm91bmQgOiAocikgLT5cclxuXHRcdGlmIEBvcHBbcl0gPT0gZy5CWUUgdGhlbiByZXR1cm4gZy5LICogKDEuMCAtIGcuc2NvcmluZ1Byb2JhYmlsaXR5IDApXHJcblx0XHRpZiBAb3BwW3JdID09IGcuUEFVU0UgdGhlbiByZXR1cm4gMFxyXG5cdFx0aWYgciA+PSBAcmVzLmxlbmd0aCB0aGVuIHJldHVybiAwXHJcblx0XHRhID0gQGVsb1xyXG5cdFx0YiA9IGcudG91cm5hbWVudC5wZXJzb25zW0BvcHBbcl1dLmVsb1xyXG5cdFx0ZGlmZiA9IGIgLSBhXHJcblx0XHRnLksgKiAoQHJlc1tyXS8yIC0gZy5zY29yaW5nUHJvYmFiaWxpdHkgZGlmZilcclxuXHJcblx0Y2hhbmdlIDogKHJvdW5kcykgLT5cclxuXHRcdGlmIHJvdW5kcyBvZiBAY2FjaGUgdGhlbiByZXR1cm4gQGNhY2hlW3JvdW5kc11cclxuXHRcdEBjYWNoZVtyb3VuZHNdID0gZy5zdW0gKEBjYWxjUm91bmQgciBmb3IgciBpbiByYW5nZSByb3VuZHMpXHJcblxyXG5cdGF2Z0Vsb0RpZmYgOiAtPlxyXG5cdFx0cmVzID0gW11cclxuXHRcdGZvciBpZCBpbiBAb3BwLnNsaWNlIDAsIEBvcHAubGVuZ3RoIC0gMVxyXG5cdFx0XHRpZiBpZCA+PSAwIHRoZW4gcmVzLnB1c2ggYWJzIEBlbG8gLSBnLnRvdXJuYW1lbnQucGVyc29uc1tpZF0uZWxvXHJcblx0XHRpZiByZXMubGVuZ3RoID09IDAgdGhlbiAwIGVsc2UgZy5zdW0ocmVzKSAvIHJlcy5sZW5ndGhcclxuXHJcblx0YmFsYW5zIDogLT4gIyBmw6RyZ2JhbGFuc1xyXG5cdFx0cmVzdWx0ID0gMFxyXG5cdFx0Zm9yIGNoIGluIEBjb2xcclxuXHRcdFx0aWYgY2g9PSdiJyB0aGVuIHJlc3VsdCAtPSAxXHJcblx0XHRcdGlmIGNoPT0ndycgdGhlbiByZXN1bHQgKz0gMVxyXG5cdFx0cmVzdWx0XHJcblxyXG5cdHJlYWQgOiAocGxheWVyKSAtPiBcclxuXHRcdEBlbG8gPSBwYXJzZUludCBwbGF5ZXJbMF1cclxuXHRcdEBuYW1lID0gcGxheWVyWzFdXHJcblx0XHRAb3BwID0gW11cclxuXHRcdEBjb2wgPSBcIlwiXHJcblx0XHRAcmVzID0gXCJcIlxyXG5cdFx0aWYgcGxheWVyLmxlbmd0aCA8IDMgdGhlbiByZXR1cm5cclxuXHRcdG9jcnMgPSBwbGF5ZXJbMl1cclxuXHRcdGZvciBvY3IgaW4gb2Nyc1xyXG5cdFx0XHRpZiAndycgaW4gb2NyIHRoZW4gY29sPSd3J1xyXG5cdFx0XHRpZiAnYicgaW4gb2NyIHRoZW4gY29sPSdiJ1xyXG5cdFx0XHRpZiAnXycgaW4gb2NyIHRoZW4gY29sPSdfJ1xyXG5cdFx0XHRhcnIgPSBvY3Iuc3BsaXQgY29sXHJcblx0XHRcdEBvcHAucHVzaCBwYXJzZUludCBhcnJbMF1cclxuXHRcdFx0QGNvbCArPSBjb2xcclxuXHRcdFx0aWYgYXJyLmxlbmd0aCA9PSAyIGFuZCBhcnJbMV0ubGVuZ3RoID09IDEgdGhlbiBAcmVzICs9IGFyclsxXVxyXG5cclxuXHR3cml0ZSA6IC0+ICMgKDEyMzQhQ2hyaXN0ZXIhKDEydzAhMjNiMSExNHcyKSkgRWxvOjEyMzQgTmFtZTpDaHJpc3RlciBvcHBvbmVudDoyMyBjb2xvcjpiIHJlc3VsdDoxXHJcblx0XHRyZXMgPSBbXVxyXG5cdFx0cmVzLnB1c2ggQGVsb1xyXG5cdFx0cmVzLnB1c2ggQG5hbWUucmVwbGFjZUFsbCAnICcsJ18nXHJcblx0XHRyID0gQG9wcC5sZW5ndGggLSAxXHJcblx0XHRvY3IgPSAoXCIje0BvcHBbaV19I3tAY29sW2ldfSN7aWYgaSA8IHIgdGhlbiBAcmVzW2ldIGVsc2UgJyd9XCIgZm9yIGkgaW4gcmFuZ2UocikpIFxyXG5cdFx0cmVzLnB1c2ggd3JhcCBvY3Iuam9pbiAnISdcclxuXHRcdHJlcy5qb2luICchJ1xyXG4iXX0=
//# sourceURL=c:\github\ELO-Pairings\coffee\player.coffee